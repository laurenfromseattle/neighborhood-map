var mapModel=function(){var e={},t={},o={center:{lat:47.624098,lng:-122.356438},scrollwheel:!0,draggable:!0,zoom:function(){return $(window).width()<500?14:16}(),styles:[{featureType:"all",elementType:"labels.text.fill",stylers:[{color:"#b4dce2"}]},{featureType:"all",elementType:"labels.text.stroke",stylers:[{visibility:"on"},{color:"#20505f"},{weight:2},{gamma:.84}]},{featureType:"all",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"geometry",stylers:[{weight:.6},{color:"#094251"}]},{featureType:"landscape",elementType:"geometry",stylers:[{color:"#16414f"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#518fa0"}]},{featureType:"poi",elementType:"geometry.fill",stylers:[{lightness:-20}]},{featureType:"poi.attraction",elementType:"geometry.fill",stylers:[{lightness:0}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#11586b"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#12869b"},{lightness:-37}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{lightness:-10}]},{featureType:"road.arterial",elementType:"geometry.stroke",stylers:[{lightness:-5}]},{featureType:"road.arterial",elementType:"labels.text.fill",stylers:[{lightness:0}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{lightness:-15}]},{featureType:"road.local",elementType:"geometry.stroke",stylers:[{lightness:"-10"},{gamma:"1.00"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#518fa0"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#05323e"}]}]};return{getMap:function(){return e},setMap:function(t){"object"==typeof t&&(e=t)},getMapBounds:function(){return t},updateMapBounds:function(e){"object"==typeof e&&(t=e)},getMapOptions:function(){return o},updateMapOptions:function(e){"object"==typeof e&&(o=e)}}}(),locationModel=function(){var e=0,t=[{categories:[["Dive Bars","divebars"]],id:"streamline-tavern-seattle-2",location:{address:["174 Roy St"],city:"Seattle",coordinate:{latitude:47.6256104,longitude:-122.3528064}},name:"Streamline Tavern",rating:4.5,rating_img_url:"https://s3-media2.fl.yelpcdn.com/assets/2/www/img/99493c12711e/ico/stars/v1/stars_4_half.png",review_count:24,snippet_text:"Great dive bar for some pool. Food is usually limited to peanuts. I mostly love it because it replaced Jabu's.",url:"http://www.yelp.com/biz/streamline-tavern-seattle-2?utm_campaign=yelp_api&utm_medium=api_v2_search&utm_source=pr1wuv4t-ZC9wqQWVsJ68g"},{categories:[["American (Traditional)","tradamerican"],["Dive Bars","divebars"],["Breakfast & Brunch","breakfast_brunch"]],id:"mecca-cafe-seattle",location:{address:["526 Queen Anne Ave N"],city:"Seattle",coordinate:{latitude:47.62412,longitude:-122.35637}},name:"Mecca Cafe",rating:4,rating_img_url:"https://s3-media4.fl.yelpcdn.com/assets/2/www/img/c2f3dd9799a5/ico/stars/v1/stars_4.png",review_count:421,snippet_text:"HUGE serving sizes of all-American diner food. Amazing bartenders. What more do you need?",url:"http://www.yelp.com/biz/mecca-cafe-seattle?utm_campaign=yelp_api&utm_medium=api_v2_search&utm_source=pr1wuv4t-ZC9wqQWVsJ68g"}],o=function(){viewModel.resetMapCenter({lat:47.624098,lng:-122.356438}),$.each(t,function(e,t){t.selected=ko.observable(!1),viewModel.locations.push(t),a.push(t),viewModel.renderMarker(t),$.each(t.categories,function(e,t){-1===n.indexOf(t[1])&&(viewModel.cuisines.push(t[1]),n.push(t[1]))})})},a=[],n=[],i=function(){var t=mapModel.getMapBounds(),i=t.H.H,r=t.j.H,s=t.H.j,l=t.j.j,c="pr1wuv4t-ZC9wqQWVsJ68g",u="9bndcm-Ho1RhwE5btDVJYJKbv4w",p="N57vSZkvDXsVAwk7M8j8qRCKNtwS5ywi",d="FiugcPuk-Bh66cWuSaBe18wZGjU",m="https://api.yelp.com/v2/search",f="restaurants",g=function(){return Math.floor(1e12*Math.random()).toString()},y=function(){return Math.floor(Date.now()/1e3)},w={oauth_consumer_key:c,oauth_token:p,oauth_signature_method:"HMAC-SHA1",oauth_timestamp:y(),oauth_nonce:g(),oauth_version:"1.0",callback:"cb",term:f,bounds:i+","+r+"|"+s+","+l},h=oauthSignature.generate("GET",m,w,u,d);w.oauth_signature=h;var v=function(){w.oauth_timestamp=y(),w.oauth_nonce=g(),void 0===w.offset?w.offset=20:w.offset+=20,delete w.oauth_signature},b=function(){var e=oauthSignature.generate("GET",m,w,u,d);w.oauth_signature=e},M=function(){$.ajax({url:m,data:w,cache:!0,dataType:"jsonp"}).done(function(t){t.businesses.length>0?(e++,$.each(t.businesses,function(e,t){t.selected=ko.observable(!1),viewModel.locations.push(t),a.push(t),viewModel.renderMarker(t),$.each(t.categories,function(e,t){-1===n.indexOf(t[1])&&(viewModel.cuisines.push(t[1]),n.push(t[1]))})}),viewModel.locations.sort(function(e,t){return e.name.localeCompare(t.name)}),viewModel.cuisines.sort(),v(),b()):0===e&&(alert("Sorry, Yelp can't find any restaurants in your area."),o())}).fail(function(){alert("Sorry. We had issues talking to Yelp. Here are some locations we love in Lower Queen Anne, Seattle."),o()})};M()};return{cuisines:n,getLocations:i,staticLocationList:a}}(),viewModel=function(){var e,t=$(".map-div")[0],o=[],a=[],n=ko.observableArray([]),i=ko.observableArray([]),r=ko.observable(),s=function(){if(navigator.geolocation){var o=function(o){var a=o.coords.latitude,n=o.coords.longitude,i=mapModel.getMapOptions();i.center={lat:a,lng:n},e=new google.maps.Map(t,i),u()},a=function(o){1===o.code?alert("Don't want us to know where you are? That makes it a bit difficult to help you find a restaurant! Here are some places you can check out next time you are in Lower Queen Anne, Seattle."):2===o.code?alert("We had a problem locating you. Here are some places you can check out next time you are in Lower Queen Anne, Seattle."):alert("Locating you is taking too much time. Here are some places you can check out next time you are in Lower Queen Anne, Seattle."),e=new google.maps.Map(t,mapModel.getMapOptions()),u()},n={timeout:1e4,maximumAge:0};navigator.geolocation.getCurrentPosition(o,a,n)}else alert("Your browser does not support geolocation. That means we have no idea where you are. Here are some places you can check out next time you are in Lower Queen Anne, Seattle."),e=new google.maps.Map(t,mapModel.getMapOptions()),u()},l=function(){alert("Sorry, Google Maps data can't be loaded.")},c=function(){$(t).removeClass("loading")},u=function(){c(),mapModel.setMap(e);var t=google.maps.event.addListener(e,"tilesloaded",function(){p(),locationModel.getLocations(),google.maps.event.removeListener(t)})},p=function(){var t=e.getBounds();mapModel.updateMapBounds(t)},d=function(t){e.setCenter(t)},m=function(t){var i=new google.maps.Marker({position:{lat:t.location.coordinate.latitude,lng:t.location.coordinate.longitude},map:e,icon:"img/map-marker.svg",title:t.name,id:t.id});i.infowindow=new google.maps.InfoWindow({content:'<p class="infowindow-location-name">'+t.name+'</p><p class="infowindow-location-address">'+t.location.address[0]+'</p><p class="infowindow-location-rating"><img class="infowindow-location-stars" alt="Yelp rating: '+t.rating+'" src="'+t.rating_img_url+'" /><span class="infowindow-location-rating-count">'+t.review_count+'&nbsp;reviews</span></p><p class="infowindow-location-review">'+t.snippet_text+'</p><a class="infowindow-location-link" href="'+t.url+'" target="_blank">Read reviews on Yelp</a>',maxWidth:200}),google.maps.event.addListener(i.infowindow,"closeclick",function(){h(),v()}),i.addListener("click",function(t,o){return function(){h(),v(),a.push(o),t.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){t.setAnimation(null),o.open(e,t)},700);var i,r=70;$.each(n(),function(e,o){n()[e].id===t.id?(n()[e].selected(!0),i=e*r,$(".location-list").animate({scrollTop:i},1e3)):n()[e].selected(!1)})}}(i,i.infowindow)),o.push(i)},f=function(t){if(t.selected()===!1){var i;h(),v(),$.each(o,function(e,o){o.title===t.name&&(i=o)}),a.push(i.infowindow),i.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){i.setAnimation(null),i.infowindow.open(e,i)},700);var r,s=70;$.each(n(),function(e,t){n()[e].id===i.id?(n()[e].selected(!0),r=e*s,$(".location-list").animate({scrollTop:r},1e3)):n()[e].selected(!1)})}else h(),v()},g=ko.computed(function(){void 0!==r()&&(h(),v(),n.remove(function(e){var t=!0;return $.each(e.categories,function(e,o){return o[1]===r()?t=!1:void 0}),t})),$.each(o,function(e,t){var o=!1;$.each(n(),function(e,a){-1!==a.name.indexOf(t.title)&&(o=!0)}),o||t.setMap(null)})}),y=ko.computed(function(){return void 0!==r()}),w=function(){h(),v(),r(void 0),n(locationModel.staticLocationList.slice()),n.sort(function(e,t){return e.name.localeCompare(t.name)}),$.each(o,function(t,o){o.setMap(e)})},h=function(){0!==a.length&&(a[0].close(),a=[])},v=function(){$.each(n(),function(e,t){n()[e].selected(!1)})};return $(".sidebar-toggle").click(function(){$(".sidebar").hasClass("toggle")?$(".sidebar").removeClass("toggle"):$(".sidebar").addClass("toggle")}),$(".sidebar").draggable({axis:"x",containment:"parent",handle:".slider"}),{initMap:s,mapLoadError:l,locations:n,cuisines:i,selectedCuisine:r,gmarkers:o,renderMarker:m,filteredLocations:g,filterSelected:y,clearFilter:w,openMarker:f,resetMapCenter:d}}();ko.applyBindings(viewModel);